define(function(require){var conf=require("conf");var frame=require("frame");var ajax=require("ajax");var o={};var h5page;function init(){h5page=new MWT.H5Page({render:frame.getRender(),header:frame.createHeader({items:[{label:"<h1>论坛</h1>"}]}),bodyStyle:"background-color:#f2f2f2;padding:0;",pagebody:'<div id="forumlistdiv"></div>'+require("common/copyright").footer()});h5page.on("open",query)}function query(){ajax.loadcache("version=4&module=forumindex",function(res){render(res.Variables.catlist,res.Variables.forumlist)})}function render(catlist,forumlist){var forummap={};for(var i=0;i<forumlist.length;++i){var im=forumlist[i];forummap[im.fid]=i}var code="";for(var i=0;i<catlist.length;++i){var cartname=catlist[i].name;var style=i==0?'style="margin:0;"':"";code+='<div style="background:#fff;">'+'<div class="weui_cells_title mwt-border-bottom" '+style+">"+cartname+"</div>"+'<div class="weui_cells">';for(var k=0;k<catlist[i].forums.length;++k){var fid=catlist[i].forums[k];var fix=forummap[fid];var fim=forumlist[fix];var icon=fim.icon?fim.icon:conf.default_forum_icon;code+='<div name="fmdiv" data-fid="'+fid+'" data-fname="'+fim.name+'" class="weui_cell">'+'<div class="weui_cell_hd"><img src="'+icon+'" style="width:40px;height:40px;margin-right:10px;display:block"></div>'+'<div class="weui_cell_bd weui_cell_primary">'+""+fim.name+"<br>"+'<span style="font-size:13px;">主题:'+fim.threads+" | 帖子:"+fim.posts+"</span>"+"</div>"+'<div class="weui_cell_ft">'+'<span style="border-radius:300px;background:#666;color:#fff;font-size:12px;padding:5px 10px;">'+"今日: "+fim.todayposts+"</span></div>"+"</div>"}code+="</div></div>"}jQuery("#forumlistdiv").html(code);jQuery("[name=fmdiv]").click(function(){var fid=jQuery(this).data("fid");var fname=jQuery(this).data("fname");require("./forumdisplay").open(fid,"slideRight")})}o.open=function(animate){if(!h5page)init();h5page.setAnimate(animate).open()};return o});